<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Customising Django-Mingus</title>
        <link rel="stylesheet" href="../../../../theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../../../">rosemanblog </a></h1>
                <nav><ul>
                    <li class="active"><a href="../../../../category/technical.html">Technical</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="../../../../2009/10/04/customising-django-mingus/" rel="bookmark"
           title="Permalink to Customising Django-Mingus">Customising Django-Mingus</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2009-10-04T07:30:28">
                Sun 04 October 2009
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="../../../../author/daniel-roseman.html">Daniel Roseman</a>
        </address>
<p>In <a href="../../../../category/technical.html">Technical</a>. </p>
<p>tags: <a href="../../../../tag/django.html">django</a><a href="../../../../tag/mingus.html">mingus</a></p>
</footer><!-- /.post-info -->      <p>This blog is built using Kevin Fricovsky's excellent <a href="http://github.com/montylounge/django-mingus">django-mingus</a> project, which is mainly a set of standard pre-existing reusable apps with some templates and a bit of glue to hold it together.</p>
<p>Although it's quite usable out of the box, I found - inveterate hacker that I am - that there were several things that I didn't quite like in the project as it was. So I changed them (isn't open source great, laydees-n-genelmen). At some point I'll fork the project on github and upload the changes, but for now here's what I've done.</p>
<p>Firstly, mingus forsakes Django's built-in comments framework for the external <a href="http://disqus.com/">Disqus</a> project. I didn't really fancy signing up for another service - especially as I'm not expecting vast numbers of comments on this blog. It's quite a simple matter to reinstate the comments - the relevant template code is included in the <code>post_detail.html</code> template included with the basic-blog app which mingus extends, so I just needed to copy and paste it into the mingus version. Then add <code>(r'comments/', include('django.contrib.comments.urls')),</code> to urls.py, <code>django.contrib.comments</code> to settings.py, run a syncdb and it's all done.</p>
<p>There are however a couple of missing pieces here. basic-blog doesn't include templates for the comment preview and post confirmation, so you just get an unstyled white page. Simple to fix: add a comments directory with a <code>base.html</code> template as follows:</p>
<div class="highlight"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>


<p>By default the post-confirmation page doesn't include a link back to the original object, leaving the user nowhere. So an overwritten <code>posted.html</code> in the same directory fixes that:</p>
<div class="highlight"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;comments/base.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>    
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">trans</span> <span class="s2">&quot;Thanks for commenting&quot;</span> <span class="cp">%}</span>.<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>    
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
  <span class="nt">&lt;h2&gt;</span><span class="cp">{%</span> <span class="k">trans</span> <span class="s2">&quot;Thank you for your comment&quot;</span> <span class="cp">%}</span>.<span class="nt">&lt;/h2&gt;</span>    
  <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">comment.get_content_object_url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span>Return to blog<span class="nt">&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>


<p>The last issue with comments was that there was no indication on the index page of how many comments each post had. This is a standard feature of blogs, and a bit surprising it wasn't there - perhaps it's a consequence of using Disqus. Anyway, the solution was to add the following to <code>templates/proxy/includes/post_item.html</code>:</p>
<div class="highlight"><pre><span class="cp">{%</span> <span class="k">if</span> <span class="nv">object.content_object.allow_comments</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">get_comment_count</span> <span class="nv">for</span> <span class="nv">object.content_object</span> <span class="k">as</span> <span class="nv">comment_count</span> <span class="cp">%}</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;comment_count&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">object.content_object.get_absolute_url</span> <span class="cp">}}</span><span class="s">#comments&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">comment_count</span> <span class="cp">}}</span> comment<span class="cp">{{</span> <span class="nv">comment_count</span><span class="o">|</span><span class="nf">pluralize</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>


<p>I also added a style rule for the <code>.comment_count</code> class in base.css.</p>
<p>So much for comments. Now, layout. I couldn't help thinking that the default layout had the main area to narrow and the right-hand column too wide. Luckily the templates are based on the <a href="http://github.com/montylounge/django-mingus">960 Grid System</a> css, so it was easy to change the central column to use the <code>grid_11 suffix_1</code> classes, for a width of 11/16 and a gutter of 1/16, and the right-hand column to use <code>grid_4</code>.</p>
<p>The final issue was to do with markup - that was a bit more complicated, so I'll leave it to part 2.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://twitter.com/danielroseman">twitter</a></li>
                            <li><a href="http://github.com/danielroseman">github</a></li>
                            <li><a href="http://stackoverflow.com/users/104349/daniel-roseman">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>