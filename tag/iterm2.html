<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>rosemanblog - iterm2</title>
        <link rel="stylesheet" href="../theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../">rosemanblog </a></h1>
                <nav><ul>
                    <li><a href="../category/technical.html">Technical</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../2012/02/04/improving-vim-terminal-development-environment/">Improving the vim terminal development environment</a></h1>
<footer class="post-info">
        <abbr class="published" title="2012-02-04T14:21:27">
                Sat 04 February 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="../author/daniel-roseman.html">Daniel Roseman</a>
        </address>
<p>In <a href="../category/technical.html">Technical</a>. </p>
<p>tags: <a href="../tag/vim.html">vim</a><a href="../tag/iterm2.html">iterm2</a></p>
</footer><!-- /.post-info --><p>Since I started working at Google, I've been doing almost all my development using vim through the terminal. Since <a href="/2010/12/15/macvim-terminal-vim/">my last post</a> on the subject (over a year ago - bad blogger), I've discovered some significant improvements to what I recommended there, and I thought I'd share what I've learned.</p>
<p>The biggest improvement is to switch to <a href="http://www.iterm2.com/">iTerm2</a> as my terminal - thanks to <a href="http://rosslawley.co.uk/">Ross</a> for the recommendation. Not only does it remove the need for the TerminalColors hack, it also supports mouse events natively - so the MouseTerm hack is no longer needed. Plus, it includes support for control codes that change the cursor shape, so it is now simple to get vim to show whether it's in normal or insert mode. Just add these lines to <code>.vimrc</code>:</p>
<div class="highlight"><pre><span class="k">let</span> &amp;<span class="nb">t_SI</span> <span class="p">=</span> <span class="s2">&quot;\&lt;Esc&gt;]50;CursorShape=1\x7&quot;</span>
<span class="k">let</span> &amp;<span class="nb">t_EI</span> <span class="p">=</span> <span class="s2">&quot;\&lt;Esc&gt;]50;CursorShape=0\x7&quot;</span>
</pre></div>


<p>The latest version of iTerm2 has another trick up its sleeve. It integrates seamlessly with a custom version of <a href="http://tmux.sourceforge.net/">tmux</a>, the terminal multiplexer that's an alternative to GNU Screen. Using any mulitplexer allows you to connect to a remote server with a single connection, and open as many tabs/windows to that connection as you like - and, what's more, you can detach your session when you log out and re-attach later, bringing your terminals back exactly how you left them. Useful enough, but what iTerm2 adds is native support for tmux tabs and windows - so that they open as tabs/windows on the Mac desktop, and you can switch between them using normal Mac shortcuts rather than tmux-specific ones. Very useful: it involves compiling a custom version of tmux and some associated libraries on the server, but it's well worth it.</p>
<p>One missing element was the ability to cut-and-paste directly from vim into apps running on the Mac. This was tricky to get right.</p>
<p>The basic principle is for the X clipboard to be shared with the OS X pasteboard, and then to to get vim to yank/delete to that clipboard. To get this working, I needed to run an X server on my Mac and enable clipboard sharing - it needs to be running for this, even if you're not using any X applications. There is an X11 app supplied with OS X, but (on Snow Leopard at least) it didn't seem to support the correct settings. Although it might be possible to get it working with some use of <code>defaults write</code>, the easier solution is to use the open-source <a href="http://xquartz.macosforge.org/trac/wiki">XQuartz</a> project - it's the same as the supplied X11.app, but updated more frequently. The version that Google had, luckily, already installed on my machine (2.7.0) includes a Pasteboard tab on the Preferences dialog which controls syncing between Mac Pasteboard and X clipboard - you need to tick "Enable syncing", "Update Pasteboard when CLIPBOARD changes", and "Update CLIPBOARD when Pasteboard changes".</p>
<p>The next step is to ensure that the SSH connection to the development machine uses X forwarding, which simply means using <code>ssh -X</code> when connecting. If the remote machine/VM is headless, it may not have any of the X stuff installed: installing the <code>xauth</code> package is probably enough to bring in the necessary dependencies, but I'm definitely not an expert here.</p>
<p>Now, in vim, you can yank to the X clipboard by using the <code>+</code> register, using <code>"+y</code> - I now have this mapped to Ctrl-C, which is close enough to the Mac's default of Cmd-C that I find it easy to remember. In bleeding-edge versions of vim later than 7.3.74, there is actually an additional option that you can use so that all yanks go directly to the X clipboard: <code>set clipboard=unnamedplus</code>. But I found that this ignores the difference between line-wise and character-wise selection, treating everything as character-wise, so cutting and pasting full lines inside vim becomes unnecessarily annoying. Better to learn the extra shortcut for those times when I explicitly need to copy out of vim.</p>
<p>One final update to my last post: I talked there about switching between tabs, but I've now stopped using tabs altogether. Seriously, folks, if you're using vim, learn about buffers: they are great. Especially with the latest version of Command-T which allows you to use the same fuzzy-matching search to switch between open buffers using <code>&lt;leader&gt;b</code>. Another advantage of buffers over tabs is that it allows you to have multiple windows open simultaneously in the same session: <code>Ctrl-w v</code> splits the main window horizontally, and <code>Ctrl-w w</code> switches between open windows (I've actually remapped Tab in normal mode to this). With a large monitor coupled with Google's <em>extremely</em> strict 80-character limit, you can easily have two or three files next to each other. A real productivity boost.</p>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://twitter.com/danielroseman">twitter</a></li>
                            <li><a href="http://github.com/danielroseman">github</a></li>
                            <li><a href="http://stackoverflow.com/users/104349/daniel-roseman">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>